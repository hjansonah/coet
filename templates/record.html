<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Coët Records</title>
    <style>
        body { font-family: Arial, sans-serif; background-color: #111; color: #fff; padding: 2rem; }
        table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
        th, td { padding: 0.5rem; border: 1px solid #555; text-align: left; }
        th { background-color: #222; }
        tr:nth-child(even) { background-color: #1a1a1a; }
        td[contenteditable] { background-color: #222; }
        button { margin-top: 1rem; padding: 0.5rem 1rem; }
    </style>
</head>
<body>
    <h1>Coët Records</h1>

    <table id="recordsTable">
        <thead>
            <tr>
                {% for col in columns %}
                    <th>{{ col }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for row in rows %}
                <tr data-id="{{ row['ID'] }}">
                    {% for col in columns %}
                        <td contenteditable="{{ 'false' if col == 'ID' else 'true' }}" data-col="{{ col }}">{{ row[col] }}</td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <button onclick="saveChanges()">Save Changes</button>

    <script>
        function saveChanges() {
            const updates = [];
            const rows = document.querySelectorAll('#recordsTable tbody tr');

            rows.forEach(row => {
                const id = row.getAttribute('data-id');
                const cells = row.querySelectorAll('td');

                const updatedRow = { ID: id };
                cells.forEach(cell => {
                    const col = cell.getAttribute('data-col');
                    if (col !== 'ID') {
                        updatedRow[col] = cell.innerText.trim();
                    }
                });

                updates.push(updatedRow);
            });

            fetch('/update_records', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ updates: updates })
            })
            .then(response => response.json())
            .then(data => alert(data.message))
            .catch(error => alert('Error: ' + error));
        }
    </script>
</body>
</html>
